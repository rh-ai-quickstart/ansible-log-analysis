FROM registry.access.redhat.com/ubi8/python-312

# Set labels for container metadata
LABEL maintainer="Yossi Elias <yelias@redhat.com>"
LABEL description="AAP Log Collector - Polls AAP logs through API and writes them to a shared volume"
LABEL version="1.0"

# Create app directory
WORKDIR /app

# Install dependencies first (for better layer caching)
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY app/ ./app/

# Ensure /app is writable by group 0 before switching to user 1001.
USER root
RUN chmod -R g=u /app
USER 1001

# Set Python to run in unbuffered mode (better for logging)
ENV PYTHONUNBUFFERED=1

# Set the entrypoint
CMD ["python", "-m", "app.main"]
