.PHONY: deploy start stop status help postgres phoenix loki-stack aap-mock replay stop-replay backend ui annotation health logs restart clean stop-postgres stop-phoenix stop-loki-stack stop-aap-mock embedding stop-embedding wait-for-embedding minio stop-minio rag stop-rag test-embedding test-rag
.DEFAULT_GOAL := help

include ../../.env
export $(shell sed 's/=.*//' ../../.env | xargs)

COMPOSE_CMD := $(shell command -v docker-compose 2>/dev/null || command -v podman-compose 2>/dev/null)

train: run-whole-training-pipeline
training: run-whole-training-pipeline

uninstall: stop

install: start
deploy: start

help: ## Show this help message
	@echo "ðŸš€ Ansible Log Monitor - Local Deployment"
	@echo ""
	@echo "Available targets:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  %-12s %s\n", $$1, $$2}'
	@echo ""
	@echo "ðŸ“š RAG Setup:"
	@echo "  1. Place PDF files in data/knowledge_base/"
	@echo "  2. Start services: 'make start' (includes RAG service)"
	@echo "  3. Run 'make run-whole-training-pipeline' to build RAG index and save to MinIO"
	@echo "  4. RAG service will automatically load index from MinIO when ready"
	@echo "  5. Ensure RAG_ENABLED=true and RAG_SERVICE_URL=http://alm-rag:8002 in .env file"
	@echo ""


start: stop ## ðŸš€ Start all services locally
	@echo "ðŸš€ Starting local deployment of Ansible Log Monitor..."
	@echo "ðŸ”Œ Cleaning up any existing processes..."
	@$(MAKE) -s postgres
	@echo "   Waiting for PostgreSQL to be ready..."
	@$(MAKE) -s phoenix
	@$(MAKE) -s loki-stack
	@$(MAKE) -s rag-stack & $(MAKE) -s aap-mock & wait
	@$(MAKE) -s backend
	@$(MAKE) -s ui
	@$(MAKE) -s annotation
	@echo ""
	@echo "ðŸŽ‰ All services are running!"
	@sleep 8
	@$(MAKE) -s status
	@echo ""
	@echo "Press Ctrl+C to stop all services, or run 'make stop'"
	@bash -c 'trap "exit" SIGINT SIGTERM; while true; do sleep 5; done'

postgres: ## ðŸ“Š Start PostgreSQL database
	@echo "   Starting PostgreSQL database..."
	@$(COMPOSE_CMD) -f compose.yaml up -d postgres

phoenix: ## ðŸ“Š Start Phoenix
	@echo "   Starting Phoenix..."
	@$(COMPOSE_CMD) -f compose.yaml up -d phoenix

loki-stack: ## ðŸ“Š Start Loki stack (Loki, Loki MCP Server, Grafana, Promtail)
	@echo "   Starting Loki stack (Loki, Loki MCP Server, Grafana, Promtail)..."
	@$(COMPOSE_CMD) -f compose.yaml up -d loki loki-mcp-server grafana promtail

rag-stack: ## ðŸ” Start RAG stack (Embedding, MinIO, RAG Service)
	@echo "   Starting RAG stack (Embedding, MinIO, RAG Service)..."
	@$(COMPOSE_CMD) -f compose.yaml up -d alm-embedding minio alm-rag
	@echo "   âš ï¸  Note: RAG service will poll MinIO for index"
	@echo "   It will become ready once index is available (after init job runs)"

wait-for-embedding: ## â³ Wait for embedding service to be ready (optional, for manual use)
	@echo "   Waiting for embedding service to be ready (this may take 3-5 minutes for model loading)..."
	@timeout=300; \
	elapsed=0; \
	interval=60; \
	while [ $$elapsed -lt $$timeout ]; do \
		if curl -s -f http://localhost:8080/health >/dev/null 2>&1; then \
			echo "   âœ“ Embedding service is ready!"; \
			exit 0; \
		fi; \
		echo "   â³ Still waiting... ($$elapsed/$$timeout seconds)"; \
		sleep $$interval; \
		elapsed=$$((elapsed + interval)); \
	done; \
	echo "   âš ï¸  Warning: Embedding service did not become ready within $$timeout seconds"; \
	echo "   The service may still be loading the model. Check logs with: docker-compose logs alm-embedding"; \
	exit 0

prepare-logs: ## ðŸ“‚ Flatten log files from data/logs/ into staging directory
	@echo "   Preparing log files..."
	@mkdir -p .staging/sample-logs
	@rm -rf .staging/sample-logs/* 2>/dev/null || true
	@echo "   Copying log files from ../../data/logs/..."
	@cp ../../data/logs/*/*.txt ../../data/logs/*/*.log .staging/sample-logs/ 2>/dev/null; \
	cp ../../data/logs/*.txt ../../data/logs/*.log .staging/sample-logs/ 2>/dev/null; \
	FILE_COUNT=$$(ls -1 .staging/sample-logs/ 2>/dev/null | wc -l | tr -d ' '); \
	echo "   âœ… $$FILE_COUNT log files prepared"

aap-mock: prepare-logs ## ðŸŽ­ Start AAP Mock (Log Generator) and auto-start replay
	@echo "   Starting AAP Mock (Log Generator)..."
	@$(COMPOSE_CMD) -f compose.yaml up -d aap-mock
	@echo "   Waiting for AAP Mock to load 500 files and start server..."
	@for i in $$(seq 1 90); do \
		FILE_COUNT=$$(curl -s http://localhost:8082/api/auto-loaded 2>/dev/null | grep -o '"count":[0-9]*' | grep -o '[0-9]*' || echo ""); \
		if [ -n "$$FILE_COUNT" ] && [ "$$FILE_COUNT" -gt 0 ] 2>/dev/null; then \
			echo "   âœ“ Server ready with $$FILE_COUNT files loaded!"; \
			break; \
		fi; \
		if [ $$i -eq 90 ]; then \
			echo "   âš ï¸  Timeout (90s) - server may still be loading. Try 'make replay' later."; \
		else \
			echo "   ... loading files ($$i/90) - server not ready yet"; \
			sleep 1; \
		fi; \
	done

replay: ## ðŸ”„ Start log replay on AAP Mock (loop mode)
	@echo "   Starting log replay..."
	@sleep 2
	@curl -s -X POST "http://localhost:8082/api/logs/replay" \
		-H "Content-Type: application/json" \
		-d '{"source": "auto-loaded", "id_or_path": "all", "loop": true, "rate_lines_per_sec": 100}' | head -c 200
	@echo ""
	@echo "   âœ… Replay started! View logs at http://localhost:3000 with query: {job=\"aap-mock\"}"

stop-replay: ## ðŸ›‘ Stop log replay
	@echo "   Stopping log replay..."
	@curl -s -X POST "http://localhost:8082/api/replay/stop" || true
	@echo "   âœ… Replay stopped"

backend: ## âš™ï¸ Start Backend (FastAPI)
	@echo "   Starting Backend API..."
	@cd ../.. && uv run uvicorn alm.main_fastapi:app --reload &

ui: ## ðŸ–¥ï¸ Start UI (Gradio)
	@echo "   Starting UI Interface..."
	@cd ../../services/ui && uv run gradio app.py &

annotation: ## ðŸ·ï¸ Start Annotation UI (Gradio)  
	@echo "   Starting Annotation UI..."
	@cd ../../services/annotation_interface && uv run gradio app.py &


stop: ## ðŸ›‘ Stop all services
	@echo "ðŸ›‘ Stopping all services..."
	@echo "ðŸ”§ Using: $(COMPOSE_CMD)"
	@$(MAKE) -s stop-aap-mock & \
	$(MAKE) -s stop-loki-stack & \
	$(MAKE) -s stop-postgres & \
	$(MAKE) -s stop-phoenix & \
	$(MAKE) -s stop-embedding & \
	$(MAKE) -s stop-minio & \
	$(MAKE) -s stop-rag & \
	wait
	@$(MAKE) -s kill-ports
	@echo "ðŸ‘‹ All services stopped"

stop-postgres: ## ðŸ›‘ Stop PostgreSQL database
	@$(COMPOSE_CMD) -f compose.yaml down postgres || true
	@echo "   âœ“ PostgreSQL stopped and removed"

stop-phoenix: ## ðŸ›‘ Stop Phoenix
	@$(COMPOSE_CMD) -f compose.yaml down phoenix || true
	@echo "   âœ“ Phoenix stopped and removed"

stop-loki-stack: ## ðŸ›‘ Stop Loki stack (Loki, Loki MCP Server, Grafana, Promtail)
	@$(COMPOSE_CMD) -f compose.yaml down loki-mcp-server grafana promtail loki || true
	@echo "   âœ“ Loki stack stopped and removed"

stop-aap-mock: ## ðŸ›‘ Stop AAP Mock
	@$(COMPOSE_CMD) -f compose.yaml down aap-mock || true
	@echo "   âœ“ AAP Mock stopped and removed"

stop-embedding: ## ðŸ›‘ Stop Embedding Service
	@$(COMPOSE_CMD) -f compose.yaml down alm-embedding || true
	@echo "   âœ“ Embedding service stopped and removed"

stop-minio: ## ðŸ›‘ Stop MinIO
	@$(COMPOSE_CMD) -f compose.yaml down minio || true
	@echo "   âœ“ MinIO stopped and removed"

stop-rag: ## ðŸ›‘ Stop RAG Service
	@$(COMPOSE_CMD) -f compose.yaml down alm-rag || true
	@echo "   âœ“ RAG service stopped and removed"

kill-ports: ## ðŸ”Œ Kill processes using required ports
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :7860 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 7860/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ UI 7860 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :7861 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 7861/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ Annotation 7861 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :8000 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 8000/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ Backend 8000 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :6006 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 6006/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ Phoenix 6006 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :4317 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 4317/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ Phoenix 4317 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :3100 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 3100/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ Loki 3100 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :8080 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 8080/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ Embedding service 8080 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :8081 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 8081/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ Loki MCP Server 8081 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :8002 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 8002/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ RAG Service 8002 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :3000 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 3000/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ Grafana 3000 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :8082 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 8082/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ AAP Mock 8082 killed"
	@echo "   âœ“ MinIO 9000 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :9000 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 9000/tcp 2>/dev/null || true; \
	fi
	@echo "   âœ“ MinIO 9001 killed"
	@if [ "$$(uname)" = "Darwin" ]; then \
		lsof -ti :9001 | xargs kill -9 2>/dev/null || true; \
	else \
		fuser -k 9001/tcp 2>/dev/null || true; \
	fi

status: ## ðŸ“Š Show status of all services
	@echo "ðŸ“Š Service Status:"
	@echo "   ðŸ“Š PostgreSQL: $(shell $(COMPOSE_CMD) ps 2>/dev/null | grep 'postgres' | grep -q 'Up' && echo 'Running' || echo 'Stopped') - localhost:5432"
	@echo "   ðŸ Phoenix: $(shell $(COMPOSE_CMD) ps 2>/dev/null | grep 'phoenix' | grep -q 'Up' && echo 'Running' || echo 'Stopped') - http://localhost:6006"
	@echo "   ðŸ“Š Loki: $(shell $(COMPOSE_CMD) ps 2>/dev/null | grep 'loki' | grep -v 'loki-mcp' | grep -q 'Up' && echo 'Running' || echo 'Stopped') - http://localhost:3100"
	@echo "   ðŸ” Loki MCP Server: $(shell $(COMPOSE_CMD) ps 2>/dev/null | grep 'loki-mcp-server' | grep -q 'Up' && echo 'Running' || echo 'Stopped') - http://localhost:8081"
	@echo "   ðŸ¤– Embedding Service: $(shell $(COMPOSE_CMD) ps 2>/dev/null | grep 'alm-embedding' | grep -q 'Up' && echo 'Running' || echo 'Stopped') - http://localhost:8080"
	@echo "   ðŸ” RAG Service: $(shell $(COMPOSE_CMD) ps 2>/dev/null | grep 'alm-rag' | grep -q 'Up' && echo 'Running' || echo 'Stopped') - http://localhost:8002"
	@echo "   ðŸ“ˆ Grafana: $(shell $(COMPOSE_CMD) ps 2>/dev/null | grep 'grafana' | grep -q 'Up' && echo 'Running' || echo 'Stopped') - http://localhost:3000"
	@echo "   ðŸ“ Promtail: $(shell $(COMPOSE_CMD) ps 2>/dev/null | grep 'promtail' | grep -q 'Up' && echo 'Running' || echo 'Stopped')"
	@echo "   ðŸŽ­ AAP Mock: $(shell $(COMPOSE_CMD) ps 2>/dev/null | grep 'aap-mock' | grep -q 'Up' && echo 'Running' || echo 'Stopped') - http://localhost:8082"
	@if lsof -i :8000 >/dev/null 2>&1; then \
		echo "   âš™ï¸  Backend API: Running - http://localhost:8000"; \
	else \
		echo "   âš™ï¸  Backend API: Stopped - http://localhost:8000"; \
	fi
	@if lsof -i :7860 >/dev/null 2>&1; then \
		echo "   ðŸ–¥ï¸  UI Interface: Running - http://localhost:7860"; \
	else \
		echo "   ðŸ–¥ï¸  UI Interface: Stopped - http://localhost:7860"; \
	fi
	@if lsof -i :7861 >/dev/null 2>&1; then \
		echo "   ðŸ·ï¸  Annotation UI: Running - http://localhost:7861"; \
	else \
		echo "   ðŸ·ï¸  Annotation UI: Stopped - http://localhost:7861"; \
	fi
	@if curl -s http://localhost:6006 >/dev/null 2>&1; then \
		echo "   ðŸ  Phoenix: Running - http://localhost:6006"; \
	else \
		echo "   ðŸ  Phoenix: Stopped - http://localhost:6006"; \
	fi

run-whole-training-pipeline: ## ðŸ” Run whole training pipeline (builds RAG index and runs backend init)
	@echo "ðŸ” Running whole training pipeline..."
	@echo "ðŸ“š This will build the RAG index from PDFs in data/knowledge_base/ and run backend initialization"
	@if [ ! -d "../../data/knowledge_base" ] || [ -z "$$(ls -A ../../data/knowledge_base/*.pdf 2>/dev/null)" ]; then \
		echo "âš ï¸  WARNING: No PDF files found in data/knowledge_base/"; \
		echo "   RAG index will not be created. Add PDF files and run again."; \
	fi
	@echo "ðŸ“¦ Step 1: Building RAG index..."
	@( cd ../.. && uv run --index-strategy unsafe-best-match services/rag/rag_init_pipeline.py )
	@echo "ðŸ“¦ Step 2: Running backend initialization..."
	@( cd ../.. && uv run --index-strategy unsafe-best-match backend_init_pipeline.py )

run-rag-init: ## ðŸ” Run RAG initialization only (builds RAG index)
	@echo "ðŸ” Running RAG initialization..."
	@echo "ðŸ“š This will build the RAG index from PDFs in data/knowledge_base/"
	@if [ ! -d "../../data/knowledge_base" ] || [ -z "$$(ls -A ../../data/knowledge_base/*.pdf 2>/dev/null)" ]; then \
		echo "âš ï¸  WARNING: No PDF files found in data/knowledge_base/"; \
		echo "   RAG index will not be created. Add PDF files and run again."; \
	fi
	@( cd ../.. && uv run --index-strategy unsafe-best-match services/rag/rag_init_pipeline.py )

run-backend-init: ## ðŸ” Run backend initialization only (training pipeline)
	@echo "ðŸ” Running backend initialization..."
	@echo "ðŸ“š This will run the training pipeline (clustering, summarization, etc.)"
	@( cd ../.. && uv run --index-strategy unsafe-best-match backend_init_pipeline.py )

# Add new target to check RAG status
rag-status: ## ðŸ“Š Check RAG service and index status
	@echo "ðŸ“Š RAG Service Status:"
	@if curl -s -f http://localhost:8002/health >/dev/null 2>&1; then \
		echo "   âœ… RAG service is running"; \
			if curl -s -f http://localhost:8002/ready >/dev/null 2>&1; then \
			index_size=$$(curl -s http://localhost:8002/ready | grep -o '"index_size":[0-9]*' | grep -o '[0-9]*' || echo "unknown"); \
			echo "   âœ… RAG index is loaded ($$index_size embeddings)"; \
		else \
			echo "   âš ï¸  RAG index not loaded yet (waiting for embeddings)"; \
			echo "   Run 'make run-whole-training-pipeline' to build embeddings"; \
		fi; \
	else \
		echo "   âŒ RAG service is not running"; \
		echo "   Start it with: make rag"; \
	fi
	@if [ -d "../../data/knowledge_base" ]; then \
		pdf_count=$$(ls -1 ../../data/knowledge_base/*.pdf 2>/dev/null | wc -l); \
		echo "   ðŸ“„ PDF files in knowledge_base: $$pdf_count"; \
	else \
		echo "   âš ï¸  Knowledge base directory not found"; \
	fi

test-embedding: ## ðŸ§ª Test embedding service
	@echo "ðŸ§ª Testing Embedding Service..."
	@echo ""
	@echo "1. Health Check:"
	@if curl -s -f http://localhost:8080/health >/dev/null 2>&1; then \
		echo "   âœ… Service is healthy"; \
	else \
		echo "   âŒ Service is not responding"; \
		exit 1; \
	fi
	@echo ""
	@echo "2. Generating test embedding:"
	@response=$$(curl -s -X POST http://localhost:8080/v1/embeddings \
		-H "Content-Type: application/json" \
		-d '{"model": "nomic-ai/nomic-embed-text-v1.5", "input": ["test query"]}'); \
	if echo "$$response" | grep -q '"data"'; then \
		echo "   âœ… Embedding generated successfully"; \
		echo "   Response preview: $$(echo $$response | head -c 200)..."; \
	else \
		echo "   âŒ Failed to generate embedding"; \
		echo "   Response: $$response"; \
		exit 1; \
	fi
	@echo ""
	@echo "âœ… Embedding service test passed!"

test-rag: ## ðŸ§ª Test RAG service (requires RAG service running and embeddings in PostgreSQL)
	@echo "ðŸ§ª Testing RAG Service..."
	@echo ""
	@echo "1. Health Check:"
	@if curl -s -f http://localhost:8002/health >/dev/null 2>&1; then \
		echo "   âœ… Service is healthy"; \
	else \
		echo "   âŒ Service is not responding"; \
		exit 1; \
	fi
	@echo ""
	@echo "2. Readiness Check:"
	@if curl -s -f http://localhost:8002/ready >/dev/null 2>&1; then \
		echo "   âœ… Service is ready (index loaded)"; \
	else \
		echo "   âš ï¸  Service is not ready (index not loaded yet)"; \
		echo "   Run 'make run-whole-training-pipeline' to build embeddings"; \
		exit 1; \
	fi
	@echo ""
	@echo "3. Test Query:"
	@response=$$(curl -s -X POST http://localhost:8002/rag/query \
		-H "Content-Type: application/json" \
		-d '{"query": "ansible playbook execution failed", "top_k": 5, "top_n": 3, "similarity_threshold": 0.6}'); \
	if echo "$$response" | grep -q '"results"'; then \
		echo "   âœ… Query successful"; \
		echo "   Response preview: $$(echo $$response | head -c 200)..."; \
	else \
		echo "   âŒ Query failed"; \
		echo "   Response: $$response"; \
		exit 1; \
	fi
	@echo ""
	@echo "âœ… RAG service test passed!"

health: ## ðŸ” Check health of running services
	@echo "ðŸ” Health Checks:"
	@if curl -s http://localhost:8000/health >/dev/null 2>&1; then \
		echo "   âš™ï¸  Backend http://localhost:8000: Healthy"; \
	else \
		echo "   âš™ï¸  Backend http://localhost:8000: Unhealthy"; \
	fi
	@if curl -s http://localhost:7860 >/dev/null 2>&1; then \
		echo "   ðŸ–¥ï¸  UI http://localhost:7860: Healthy"; \
	else \
		echo "   ðŸ–¥ï¸  UI http://localhost:7860: Unhealthy"; \
	fi
	@if curl -s http://localhost:7861 >/dev/null 2>&1; then \
		echo "   ðŸ·ï¸  Annotation UI http://localhost:7861: Healthy"; \
	else \
		echo "   ðŸ·ï¸  Annotation UI http://localhost:7861: Unhealthy"; \
	fi
	@if curl -s http://localhost:6006 >/dev/null 2>&1; then \
		echo "   ðŸ  Phoenix: Running - http://localhost:6006"; \
	else \
		echo "   ðŸ  Phoenix: Stopped - http://localhost:6006"; \
	fi
	@if curl -s http://localhost:3100/ready >/dev/null 2>&1; then \
		echo "   ðŸ“Š  Loki http://localhost:3100: Healthy"; \
	else \
		echo "   ðŸ“Š  Loki http://localhost:3100: Unhealthy"; \
	fi
	@if curl -s http://localhost:8081 >/dev/null 2>&1; then \
		echo "   ðŸ”  Loki MCP Server http://localhost:8081: Healthy"; \
	else \
		echo "   ðŸ”  Loki MCP Server http://localhost:8081: Unhealthy"; \
	fi
	@if curl -s http://localhost:8080/health >/dev/null 2>&1; then \
		echo "   ðŸ¤–  Embedding Service http://localhost:8080: Healthy"; \
	else \
		echo "   ðŸ¤–  Embedding Service http://localhost:8080: Unhealthy (may still be loading model)"; \
	fi
	@if curl -s http://localhost:8002/health >/dev/null 2>&1; then \
		echo "   ðŸ”  RAG Service http://localhost:8002: Healthy"; \
		if curl -s http://localhost:8002/ready >/dev/null 2>&1; then \
			echo "   ðŸ”  RAG Service http://localhost:8002: Ready (index loaded)"; \
		else \
			echo "   ðŸ”  RAG Service http://localhost:8002: Not ready (index not loaded yet)"; \
		fi; \
	else \
		echo "   ðŸ”  RAG Service http://localhost:8002: Unhealthy"; \
	fi
	@if curl -s http://localhost:3000 >/dev/null 2>&1; then \
		echo "   ðŸ“ˆ  Grafana http://localhost:3000: Healthy"; \
	else \
		echo "   ðŸ“ˆ  Grafana http://localhost:3000: Unhealthy"; \
	fi
	@if curl -s http://localhost:8082/healthz >/dev/null 2>&1; then \
		echo "   ðŸŽ­  AAP Mock http://localhost:8082: Healthy"; \
	else \
		echo "   ðŸŽ­  AAP Mock http://localhost:8082: Unhealthy"; \
	fi
restart: stop start ## ðŸ”„ Restart all services

clean: ## ðŸ§¹ Clean PID files and logs
	@echo "ðŸ§¹ Cleaning up PID files and logs..."
	@docker-compose down -v
	@echo "   âœ“ Cleanup completed"
